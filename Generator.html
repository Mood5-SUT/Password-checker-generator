<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Password Generator & Auditor</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js" integrity="" crossorigin="anonymous"></script>

      <style>
      :root{
        --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2;
        --good:#16a34a; --warn:#f59e0b; --bad:#ef4444; --info:#3b82f6;
        font-family:system-ui, sans-serif;
        color:#e6eef6;
      }
      body{
        margin:0; padding:32px;
        background:linear-gradient(180deg,#071029,#08122a);
        min-height:100vh;
        display:flex; justify-content:center; align-items:flex-start;
      }
      .card{
        width:100%; max-width:820px;
        background:rgba(255,255,255,0.03);
        border:1px solid rgba(255,255,255,0.05);
        border-radius:12px;
        padding:20px;
      }
      h2, h1{ margin:0 0 8px 0; }
      label{ font-size:14px; color:var(--muted); display:block; margin-top:10px; }
      input[type=text]{ width:100%; padding:12px; margin-top:6px;
        background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.05); border-radius:6px; color:#fff; }
      input[type=number], input[type=range]{ margin-top:6px; border-radius:6px; background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.05); color:#fff; }
      .options label{ display:flex; gap:8px; align-items:center; margin-top:2px; }
      .row{ display:flex; gap:18px; margin-top:14px; flex-wrap:wrap; }
      .col{ flex:1; min-width:0; }
      button{ margin-top:10px; padding:10px 12px; background:var(--info); border:0; border-radius:6px; color:#fff; cursor:pointer; }
      .meter{ height:12px; border-radius:8px; overflow:hidden; background:rgba(255,255,255,0.03); margin-top:12px; }
      .meter > span{ display:block; height:100%; width:0%; transition: width 220ms, background 220ms; }
      .panel{ background:rgba(255,255,255,0.015); padding:12px; border-radius:8px; font-size:13px; color:var(--muted); border:1px solid rgba(255,255,255,0.02); }
      .badge{ display:inline-block; font-weight:700; padding:6px 8px; border-radius:8px; font-size:12px; color:white; }
      .pwned{ color:var(--bad); font-weight:700; }
      .safe{ color:var(--good); font-weight:700; }
      .small-muted{ font-size:12px; color:var(--muted); margin-top:6px; }
      pre.debug{ max-height:120px; overflow:auto; background:rgba(255,255,255,0.02); padding:10px; border-radius:8px; font-size:12px; color:var(--muted);}

      .col.panel {
        background: rgba(255,255,255,0.015);
        padding: 12px;
        border-radius: 8px;
        font-size: 13px;
        color: var(--muted);
        border: 1px solid rgba(255,255,255,0.02);
        word-wrap: break-word;       /* allows long text to wrap */
        overflow-wrap: break-word;   /* modern property */
      }

      #entropy {
        margin-top:4px;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }

      nav.topbar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background: rgba(15,23,36,0.95);
        padding: 12px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 1000;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      }
      nav.topbar a {
        color: #3b82f6;
        text-decoration: none;
        font-weight: 500;
      }

    </style>
  </head>
  <body>

    <!-- Top navigation bar -->
    <nav style="position:fixed; top:0; left:0; width:97%; background:rgba(15,23,36,0.95); padding:12px 24px; display:flex; justify-content:space-between; align-items:center; z-index:1000; box-shadow:0 2px 6px rgba(0,0,0,0.3);">
      <div style="font-weight:700; font-size:18px; color:#e6eef6;">Password Auditor</div>
      <div style="display:flex; gap:12px;">
        <a href="index.html" style="color:#3b82f6; text-decoration:none; font-weight:500;">Password Checker</a>
        <a href="Generator.html" style="color:#3b82f6; text-decoration:none; font-weight:500;">Password Generator</a>
      </div>
    </nav>

    <!-- Add spacing so content does not go under nav -->
    <div style="height:60px;"></div>

    <div class="card">
      <h1>Password Generator</h1>

      <!-- Generate Password -->
      <label>Generated Password</label>
      <input id="pwOut" type="text" readonly />

      <label>Length</label>
      <div class="row">
        <input id="lenRange" type="range" min="6" max="60" value="16" />
        <input id="lenNum" type="number" min="6" max="60" value="16" style="width:80px;" />
      </div>

      <div class="options">
        <label><input type="checkbox" id="upper" checked /> Uppercase</label>
        <label><input type="checkbox" id="lower" checked /> Lowercase</label>
        <label><input type="checkbox" id="nums"  checked /> Numbers</label>
        <label><input type="checkbox" id="syms"  checked /> Symbols</label>
      </div>

      <button id="make">Generate</button>
      <button id="copy">Copy</button>

      <!-- Auditor Section -->
      <div class="meter" aria-hidden="true" title="strength meter">
        <span id="meterBar"></span>
      </div>

      <div class="row">
        <div class="col panel">
          <div class="inline">
            <div id="scoreBadge" class="badge" style="background:var(--bad)">Score: —</div>
            <div style="margin-left:8px;">
              <div id="crackTime">Time to crack: —</div>
              <div id="entropy" class="small-muted">Entropy: —</div>
            </div>
          </div>
          <div id="feedback" style="margin-top:12px;">
            <strong>Feedback:</strong>
            <div id="feedbackText" class="small-muted">Generated password info appears here.</div>
          </div>
        </div>
        <div class="col panel">
          <strong>Breached check (HIBP)</strong>
          <div style="margin-top:8px;">
            <div id="pwnStatus" class="small-muted">No check performed yet.</div>
            <div id="pwnCount" style="margin-top:8px;"></div>
          </div>
          <div class="small-muted" style="margin-top:8px;">Only first 5 chars of SHA-1 are sent.</div>
        </div>
      </div>

      <div class="row">
        <div class="col panel">
          <strong>Debug</strong>
          <pre id="debug" class="debug">idle</pre>
        </div>
      </div>

      <footer class="note">
        Generated passwords are automatically checked by the auditor.
      </footer>
    </div>

    <script>
      // Character sets
      const UPPER="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      const LOWER="abcdefghijklmnopqrstuvwxyz";
      const NUMS="0123456789";
      const SYMS="!@#$%^&*()-_=+[]{}~";

      // Elements
      const pwOut=document.getElementById("pwOut");
      const meterBar=document.getElementById("meterBar");
      const scoreBadge=document.getElementById("scoreBadge");
      const crackTime=document.getElementById("crackTime");
      const entropyEl=document.getElementById("entropy");
      const feedbackText=document.getElementById("feedbackText");
      const pwnStatus=document.getElementById("pwnStatus");
      const pwnCount=document.getElementById("pwnCount");
      const debug=document.getElementById("debug");

      const lenRange=document.getElementById("lenRange");
      const lenNum=document.getElementById("lenNum");
      const upper=document.getElementById("upper");
      const lower=document.getElementById("lower");
      const nums=document.getElementById("nums");
      const syms=document.getElementById("syms");
      const make=document.getElementById("make");
      const copy=document.getElementById("copy");

      // Sync slider & number
      lenRange.oninput = ()=> lenNum.value=lenRange.value;
      lenNum.oninput = ()=> lenRange.value=lenNum.value;

      // Generate password
      function generatePassword(len){
        let pool="";
        if(upper.checked) pool+=UPPER;
        if(lower.checked) pool+=LOWER;
        if(nums.checked) pool+=NUMS;
        if(syms.checked) pool+=SYMS;
        if(pool.length===0){ alert("Select at least one character type!"); return ""; }
        let out="";
        for(let i=0;i<len;i++) out+=pool[Math.floor(Math.random()*pool.length)];
        return out;
      }

      // SHA-1 helper
      function bufferToHex(buffer){ return Array.from(new Uint8Array(buffer)).map(b=>b.toString(16).padStart(2,'0')).join('').toUpperCase(); }
      async function sha1Hex(text){ const enc=new TextEncoder(); const data=enc.encode(text); const hash=await crypto.subtle.digest('SHA-1',data); return bufferToHex(hash); }

      const scoreColors=[
        {bg:'var(--bad)', pct:12},{bg:'var(--bad)', pct:32},{bg:'var(--warn)', pct:56},
        {bg:'var(--info)', pct:78},{bg:'var(--good)', pct:98}
      ];
      const hibpCache=new Map();

      // Password Checker
      async function checkPassword(pw){
        if(!pw){ meterBar.style.width='0%'; scoreBadge.textContent='Score: —'; scoreBadge.style.background='rgba(255,255,255,0.04)'; crackTime.textContent='Time to crack: —'; entropyEl.textContent='Entropy: —'; feedbackText.textContent=''; pwnStatus.textContent='No check performed yet.'; pwnCount.textContent=''; debug.textContent='idle'; return; }

        let zx;
        try{ zx=zxcvbn(pw); }catch(e){ zx=null; }
        if(zx){
          const score=zx.score;
          const mapping=scoreColors[score]||scoreColors[0];
          meterBar.style.width=mapping.pct+'%';
          meterBar.style.background=mapping.bg;
          scoreBadge.textContent='Score: '+score;
          scoreBadge.style.background=mapping.bg;
          const t=zx.crack_times_display.offline_slow_hashing_1e4_per_second||zx.crack_times_display.offline_fast_hashing_1e10_per_second;
          crackTime.textContent='Time to crack: '+(t||'unknown');
          entropyEl.textContent='Estimated guesses: '+(zx.guesses?Number(zx.guesses).toLocaleString()+' guesses':'—')+' — Entropy: '+(zx.entropy?zx.entropy.toFixed(1):'—');
          let advice=[];
          if(zx.feedback&&zx.feedback.suggestions) advice=zx.feedback.suggestions.slice(0,3);
          if(zx.feedback&&zx.feedback.warning) advice.unshift(zx.feedback.warning);
          feedbackText.textContent=advice.length?advice.join(' '):'Looks good — use unique password.';
        }

        // HIBP
        try{
          pwnStatus.textContent='Hashing and checking...';
          const sha1=await sha1Hex(pw);
          const prefix=sha1.slice(0,5), suffix=sha1.slice(5);
          debug.textContent=`sha1: ${sha1}\nprefix: ${prefix}\nsuffix: ${suffix}`;
          let text=hibpCache.get(prefix);
          if(!text){
            const resp=await fetch('https://api.pwnedpasswords.com/range/'+prefix,{headers:{'Accept':'text/plain'}});
            if(!resp.ok){ pwnStatus.textContent='HIBP request failed: '+resp.status; hibpCache.set(prefix,null); return; }
            text=await resp.text(); hibpCache.set(prefix,text);
          }
          if(!text){ pwnStatus.textContent='No HIBP data'; return; }
          const lines=text.split('\n');
          let foundCount=0;
          for(const line of lines){
            const parts=line.trim().split(':'); if(parts.length<2) continue;
            if(parts[0].trim().toUpperCase()===suffix.toUpperCase()){ foundCount=parseInt(parts[1].trim(),10)||0; break; }
          }
          if(foundCount>0){ pwnStatus.innerHTML='<span class="pwned">Exposed in breaches</span>'; pwnCount.textContent=`Times seen: ${foundCount.toLocaleString()}`; }
          else{ pwnStatus.innerHTML='<span class="safe">Not found in HIBP</span>'; pwnCount.textContent='No match found.'; }
        }catch(e){ pwnStatus.textContent='HIBP error: '+e.message; debug.textContent='Error: '+e.stack; }
      }

      // Generate & audit
      make.onclick = ()=>{
        const pw=generatePassword(+lenNum.value);
        pwOut.value=pw;
        checkPassword(pw);
      };

      copy.onclick=()=>{ if(!pwOut.value) return; navigator.clipboard.writeText(pwOut.value).then(()=>{ copy.textContent="Copied!"; setTimeout(()=>copy.textContent="Copy",1200); }); };

    </script>
  </body>
</html>

